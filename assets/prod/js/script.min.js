document.addEventListener("DOMContentLoaded",function(){alert("hallo");var e=document.getElementById("wf-analyzer-form");e?e.addEventListener("submit",function(e){e.preventDefault(),alert("hello")}):console.error("WF Analyzer form not found!")});let wfTestId=null,wfRetryCount=0,wfRetryDelay=1e3,wfMaxRetries=10,debugMode=!0;class WFAnalyzer{constructor(){this.debugMode=!0,this.testId=null,this.retryDelay=1e3,this.maxRetries=10,this.retryCount=0,this.statusElement=document.getElementById("wf-analyzer-status"),this.resultContainer=document.getElementById("wf-analyzer-result"),this.reportDetails=document.getElementById("wf-analyzer-report-details")}async initTest(e){try{this.updateStatus("Test wird gestartet..."),this.log("Making AJAX request: wf_start_test",{url:e});var t=await this.makeRequest("wf_start_test",{url:e});if(!t.test_id)throw new Error("Keine Test-ID zurückgegeben.");this.testId=t.test_id,this.retryCount=0,this.log("Test started successfully, Test ID:",this.testId),setTimeout(()=>{this.pollStatus()},this.retryDelay)}catch(e){this.handleError("Fehler beim Starten des Tests",e)}}async pollStatus(){if(this.testId)try{this.log("Checking status for Test ID:",this.testId),this.updateStatus("Überprüfe Teststatus...");var e,t,r,a,s,n,o,l=await this.makeRequest("wf_get_report",{test_id:this.testId});if(l.pending){if(this.log(l.message||"Test läuft noch, retrying..."),this.retryCount>=this.maxRetries)throw new Error("Maximale Anzahl an Versuchen erreicht.");this.retryCount++,this.retryDelay=Math.min(1.5*this.retryDelay,3e4),setTimeout(()=>this.pollStatus(),this.retryDelay)}else{if(!l.gtmetrix_score)throw new Error("Unbekannte Server-Antwort.");this.log("Test abgeschlossen, sende Daten ans Frontend."),this.updateStatus("Test abgeschlossen."),{gtmetrix_score:e,performance_score:t,structure_score:r,fully_loaded_time:a,largest_contentful_paint:s,time_to_first_byte:n,base64_screen_shot:o}=l,o&&(document.getElementById("wf-analyzer-screenshot").src="data:image/jpeg;base64,"+o),document.getElementById("wf-analyzer-result").classList.remove("wf-analyzer-hidden"),document.getElementById("wf-chart-container").classList.remove("wf-analyzer-hidden"),updateChartValues({gtmetrix_score:e,performance_score:t,structure_score:r,fully_loaded_time:a,largest_contentful_paint:s,time_to_first_byte:n})}}catch(e){this.handleError("Fehler beim Überprüfen des Status",e)}else this.showError("Kein Test gefunden.")}showReport(e){this.resultContainer&&this.reportDetails?(this.reportDetails.innerHTML=e,this.resultContainer.classList.remove("wf-analyzer-hidden")):this.showError("Ergebnisbereich nicht gefunden.")}updateStatus(e){this.statusElement&&(this.statusElement.innerText=e)}showError(e){console.error("Fehler:",e),alert(e)}handleError(e,t){console.error(e,t),this.showError(e+": "+(t.message||"Unbekannter Fehler"))}log(...e){this.debugMode&&console.log(...e)}}let pollStatus=async()=>{if(wfTestId)try{log("Checking status for Test ID:",wfTestId),updateStatus("Überprüfe Teststatus...");var e=await wfMakeRequest("wf_get_report",{test_id:wfTestId});e.pending?wfHandlePendingStatus(e):wfHandleCompletedStatus(e)}catch(e){wfHandleError("Fehler beim Überprüfen des Status",e)}else wfShowError("Kein Test gefunden.")},wfHandlePendingStatus=e=>{log(e.message||"Test läuft noch, retrying..."),wfRetryCount>=wfMaxRetries?wfShowError("Maximale Anzahl an Versuchen erreicht."):(wfRetryCount++,wfRetryDelay=Math.min(1.5*wfRetryDelay,3e4),setTimeout(()=>pollStatus(),wfRetryDelay))},wfHandleCompletedStatus=e=>{log("Test abgeschlossen, sende Daten ans Frontend."),updateStatus("Test abgeschlossen."),e.gtmetrix_score?wfUpdateResults(e):wfShowError("Unbekannte Server-Antwort.")},updateStatus=e=>{var t=document.getElementById("wf-analyzer-status");t&&(t.textContent=e)},wfShowError=e=>{console.error(e),alert(e)},wfUpdateResults=e=>{var{gtmetrix_score:e,performance_score:t,structure_score:r,fully_loaded_time:a,largest_contentful_paint:s,time_to_first_byte:n,base64_screen_shot:o}=e;o&&(document.getElementById("wf-analyzer-screenshot").src="data:image/jpeg;base64,"+o),document.getElementById("wf-analyzer-result").classList.remove("wf-analyzer-hidden"),document.getElementById("wf-chart-container").classList.remove("wf-analyzer-hidden"),updateChartValues({gtmetrix_score:e,performance_score:t,structure_score:r,fully_loaded_time:a,largest_contentful_paint:s,time_to_first_byte:n})},log=(...e)=>{debugMode&&console.log("[WF Analyzer]",...e)},wfMakeRequest=async(e,t)=>{try{t.security=wfAnalyzerVars.nonce;var r=await fetch(wfAnalyzerVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:e,...t})});if(!r.ok)throw new Error("Netzwerkfehler: "+r.status);var a=await r.json();if(a.success)return a.data;throw new Error(a.data.message||"Unbekannte Fehlermeldung.")}catch(e){throw new Error("AJAX Fehler: "+e.message)}},charts={};function updateChartValue(e,t){e.series(0).points(0).options({y:t})}function updateChartValues(e){updateChartValue(charts.chartPageSpeed,e.gtmetrix_score),updateChartValue(charts.chartPerformance,e.performance_score),updateChartValue(charts.chartStructure,e.structure_score),updateChartValue(charts.chartLoadTime,e.fully_loaded_time),updateChartValue(charts.chartLCP,e.largest_contentful_paint),updateChartValue(charts.chartTTFB,e.time_to_first_byte)}function createChart(e,t,r,a,s=!0){return JSC.chart(e,{debug:!1,type:"gauge",animation_duration:500,legend_visible:!1,xAxis:{spacingPercentage:.35},yAxis:{defaultTick:{padding:-5,label_style_fontSize:"12px"},line:{width:9,color:"smartPalette",breaks_gap:.07},scale_range:[0,r]},palette:{pointValue:"{%value/100}",colors:s?["red","yellow","green"]:["green","yellow","red"]},defaultTooltip_enabled:!1,defaultSeries:{angle:{sweep:200},shape:{innerSize:"65%",label:{text:`<span color="%color">{%sum:n1}</span><span color="#696969" fontSize="20px"> ${a}</span>`,style_fontSize:"50px",verticalAlign:"middle"}}},series:[{type:"column roundcaps",points:[{id:"1",x:"speed",y:t}]}]})}charts.chartPageSpeed=createChart("chartPageSpeed",0,100,"%"),charts.chartPerformance=createChart("chartPerformance",0,100,"%"),charts.chartStructure=createChart("chartStructure",0,100,"%"),charts.chartLoadTime=createChart("chartLoadTime",0,5,"s",!1),charts.chartLCP=createChart("chartLCP",0,2,"s",!1),charts.chartTTFB=createChart("chartTTFB",0,1,"s",!1);