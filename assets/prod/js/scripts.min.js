let charts={};function updateChartValue(e,t){e.series(0).points(0).options({y:t})}function updateChartValues(e){updateChartValue(charts.chartPageSpeed,e.gtmetrix_score),updateChartValue(charts.chartPerformance,e.performance_score),updateChartValue(charts.chartStructure,e.structure_score),updateChartValue(charts.chartLoadTime,e.fully_loaded_time),updateChartValue(charts.chartLCP,e.largest_contentful_paint),updateChartValue(charts.chartTTFB,e.time_to_first_byte)}function createChart(e,t,r,a,n=!0){return JSC.chart(e,{debug:!1,type:"gauge",animation_duration:1500,legend_visible:!1,xAxis:{spacingPercentage:.35},yAxis:{defaultTick:{padding:-5,label_style_fontSize:"12px"},line:{width:9,color:"smartPalette",breaks_gap:.07},scale_range:[0,r]},palette:{pointValue:`{%value/${r}}`,colors:n?["red","red","red","yellow","green"]:["green","yellow","red","red","red"]},defaultTooltip_enabled:!1,defaultSeries:{angle:{sweep:200},shape:{innerSize:"65%",label:{text:`<span color="%color">{%sum:n1}</span><span color="#696969" fontSize="20px"> ${a}</span>`,style_fontSize:"50px",verticalAlign:"middle"}}},series:[{type:"column roundcaps",points:[{id:"1",x:"speed",y:t}]}]})}charts.chartPageSpeed=createChart("chartPageSpeed",0,100,"%"),charts.chartPerformance=createChart("chartPerformance",0,100,"%"),charts.chartStructure=createChart("chartStructure",0,100,"%"),charts.chartLoadTime=createChart("chartLoadTime",0,10,"s",!1),charts.chartLCP=createChart("chartLCP",0,10,"s",!1),charts.chartTTFB=createChart("chartTTFB",0,5,"s",!1);let testId=null,retryCount=0,retryDelay=1e3,maxRetries=10,debugMode=!0,lottieAnimationFolder="/wp-content/plugins/wf-analyzer/assets/lottie/",lottieAnimations={starting:"starting-lottie.json",processing:"processing-lottie.json",done:"done-lottie.json",error:"error-lottie.json"},lottieAnimationContainer=document.getElementById("wf-lottie-container");function loadLottieAnimation(e){clearLottieAnimation(),animationInstance=lottie.loadAnimation({container:lottieAnimationContainer,renderer:"svg",loop:!0,autoplay:!0,path:lottieAnimationFolder+e,rendererSettings:{preserveAspectRatio:"xMidYMid meet"}}),lottieAnimationContainer.classList.remove("wf-analyzer-hidden")}function clearLottieAnimation(){lottieAnimationContainer.innerHTML=""}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("wf-analyzer-form");e?e.addEventListener("submit",function(e){e.preventDefault();e=document.getElementById("wf-analyzer-website-url").value.trim();e?(hideElementsAfterSubmit(),loadLottieAnimation(lottieAnimations.starting),startTest(e)):showError("Bitte geben Sie eine gültige URL ein.")}):showError("WF Analyzer form not found!")});let startTest=async e=>{updateStatus("Test wird gestartet...");e=await makeRequest("wf_start_test",{url:e});e.test_id?(setTimeout(()=>{loadLottieAnimation(lottieAnimations.processing)},1500),testId=e.test_id,retryCount=0,log("Test started successfully, Test ID:",testId),setTimeout(()=>{pollStatus()},retryDelay)):showError("Keine Test-ID zurückgegeben.")},pollStatus=async()=>{if(testId)try{log("Checking status for Test ID:",testId),updateStatus("Überprüfe Teststatus...");var e=await makeRequest("wf_get_report",{test_id:testId});e.pending?handlePendingStatus(e):handleCompletedStatus(e)}catch(e){handleError("Fehler beim Überprüfen des Status",e)}else showError("Kein Test gefunden.")},handlePendingStatus=e=>{log(e.message||"Test läuft noch, retrying..."),retryCount>=maxRetries?showError("Maximale Anzahl an Versuchen erreicht."):(retryCount++,retryDelay=Math.min(1.5*retryDelay,3e4),setTimeout(()=>pollStatus(),retryDelay))},delay=t=>new Promise(e=>setTimeout(e,t));async function handleCompletedStatus(e){if(log("Test abgeschlossen, sende Daten ans Frontend."),e.gtmetrix_score)try{await delay(1550),loadLottieAnimation(lottieAnimations.done),updateStatus("Test abgeschlossen."),await delay(1700),clearLottieAnimation(),document.getElementById("wf-analyzer-result").scrollIntoView({behavior:"smooth",block:"start"}),updateResults(e)}catch(e){handleError("Error during result update:",e)}else showError("Unbekannte Server-Antwort.")}let updateStatus=e=>{var t=document.getElementById("wf-analyzer-status");t&&(t.textContent=e)},showError=e=>{throw console.error(e),loadLottieAnimation(lottieAnimations.error),updateStatus("Es ist leider ein unerwarteter Fehler aufgetreten. Wir entschuldigen uns für die Unannehmlichkeiten. Bitte versuchen Sie es in ein paar Minuten noch einmal oder wenden Sie sich an den Support, falls das Problem weiterhin besteht."),new Error("Execution aborted")},handleError=(e,t)=>{showError(e+": "+(t.message||"Unbekannter Fehler"))},updateResults=e=>{var{gtmetrix_score:e,performance_score:t,structure_score:r,fully_loaded_time:a,largest_contentful_paint:n,time_to_first_byte:o,base64_screen_shot:s}=e;s&&(document.getElementById("wf-analyzer-screenshot").src="data:image/jpeg;base64,"+s),document.getElementById("wf-analyzer-result").classList.remove("wf-analyzer-hidden"),document.getElementById("wf-chart-container").classList.remove("wf-analyzer-hidden"),updateChartValues({gtmetrix_score:e,performance_score:t,structure_score:r,fully_loaded_time:a,largest_contentful_paint:n,time_to_first_byte:o})},hideElementsAfterSubmit=()=>{document.querySelectorAll(".wf-hide-after-submit").forEach(function(e){e.classList.add("animate__fadeOutUpBig")}),setTimeout(function(){document.querySelectorAll(".wf-hide-after-submit").forEach(function(e){e.style.display="none"})},200)},log=(...e)=>{debugMode&&console.log("[WF Analyzer]",...e)};async function makeRequest(e,t){console.log("Making AJAX request:",e,t),t.security=wfAnalyzerVars.nonce;try{var r=await fetch(wfAnalyzerVars.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:e,...t})}),a=(r.ok||handleError("Netzwerkfehler: ",r.status),await r.json());if(console.log("Server response:",a),a.success)return a.data;handleError("Anfrage auf Serverseite war nicht erfolgreich",a.data.message)}catch(e){handleError("AJAX Fehler: "+e.message)}}